<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Css do Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin="" />
    <!--Boostrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="img/map.svg" type="image/x-icon">
    <title>ISS Tracker</title>
</head>
<body>
        
    
    <div class="my-container">
        
                        
                
              
            
                <div class="hud">
                    <p>Neste momento em</p>
                    <span id='locality'>Carregando...</span>
                </div>
  
           
                <div id="map"></div>

    </div>

    <!-- JS do Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <!-- JS do Leaflet -->
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ==" crossorigin=""></script>
    <!-- <script src="js/script.js"></script> -->
    <script>
        // var map = L.map('map').setView([-22.285353906676182,-42.539959456883565], 6 );



// L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png	', {
//     maxZoom: 19,
// }).addTo(map);


var cities = L.layerGroup();

var mbAttr = '';
var mbUrl = 'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';



var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: ''
});

var dark = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: ''
});

var light = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: ''
});



var map = L.map('map', {
    center: [-22.285353906676182, -42.539959456883565],
    zoom: 10,
    layers: [dark, cities]
});

var baseLayers = {
    'Dark': dark,
    'Light': light,
    'Default': osm,

};

var overlays = {
   
};

var layerControl = L.control.layers(baseLayers, overlays).addTo(map);



var satellite = L.tileLayer(mbUrl, {id: 'mapbox/satellite-v9', tileSize: 512, zoomOffset: -1, attribution: mbAttr});
layerControl.addBaseLayer(satellite, 'Satellite');




var inverval_timer;

inverval_timer = setInterval(function() { 
    getISSCoords()
}, 5000);

function stop_timer() {
    clearInterval(inverval_timer); 
}

var ListaDeCoordenadas = []

function getISSCoords(){
    const url = 'http://api.open-notify.org/iss-now.json'


    fetch(url)
    .then((resp) => resp.json())
    .then(function(data) {
        

        let latitude =  parseFloat(data.iss_position.latitude)
        let longitude = parseFloat(data.iss_position.longitude)

        getCityName(latitude,longitude)

        // var marker = L.marker([latitude, longitude]).addTo(map);

        var circle = L.circle([latitude, longitude], {
            color: '#BB86FC',
            fillColor: '#BB86FC',
            fillOpacity: 0.5,
            radius: 150
        }).addTo(map);

        map.setView([latitude,longitude], map.getZoom());

        var atualCoordenada = new L.LatLng(latitude, longitude);
       
        if(ListaDeCoordenadas.length == 2 ){

            ListaDeCoordenadas.shift() 
        
        }

        ListaDeCoordenadas.push(atualCoordenada)
        
        

        
        var firstpolyline = new L.Polyline(ListaDeCoordenadas, {
            color: '#BB86FC',
            weight: 3,
            opacity: 0.7,
            smoothFactor: 1
        });
        firstpolyline.addTo(map);

        
    })
    .catch(function(error) {
    console.log(error);
    });
}

function getCityName(latitude, longitude){

    const URL = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=pt`
    let locationData;
    
    fetch(URL)
    .then((resp) => resp.json())
    .then(function(data) {
        
        console.log(data)
        locationData = data

        document.querySelector('#locality').textContent = data.locality 
        
       

    })
    .catch(function(error) {
    console.log(error);
    });

    return locationData

}





 

    </script>
</body>
</html>